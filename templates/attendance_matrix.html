{% extends "base.html" %}
{% block content %}
<h4 class="mb-3">
  {{ group.name }} – {{ month }}-oy, {{ year }} yil (Oylik jadval)
</h4>

<form method="POST">
  <table class="table table-bordered table-sm" style="font-size:12px;">
    <thead>
      <tr>
        <th>Ism</th>
        {% for d in days %}
          <th style="min-width:60px">{{ d.day }}</th>
        {% endfor %}
        <th>O'rtacha uy ishi %</th>
      </tr>
    </thead>
    <tbody>
      {% for s in students %}
      <tr>
        <td>{{ s.fullname }}</td>

        {% for d in days %}
        {% set key = d.isoformat() %}
        {% set att = att_map.get((s.id, d)) %}
        {% set hw  = hw_map.get((s.id, d)) %}
        <td>
          <div style="display:flex;align-items:center;gap:4px">
            <!-- Attendance checkbox -->
            <input type="checkbox"
                   name="attend_{{ s.id }}_{{ key }}"
                   {% if att and att.status %}checked{% endif %}>

            <!-- Homework select: N/A + 0–100% -->
            <select name="homework_{{ s.id }}_{{ key }}"
                    class="form-select form-select-sm"
                    style="width:70px;">
              <option value="na" {% if hw is none %}selected{% endif %}>N/A</option>
              {% for p in range(0,101) %}
                <option value="{{ p }}"
                  {% if hw and hw.percent_done==p %}selected{% endif %}>
                  {{ p }}%
                </option>
              {% endfor %}
            </select>
          </div>
        </td>
        {% endfor %}

        <!-- Average homework % -->
        <td>
          {% if avg_hw[s.id] is not none %}
            <strong>{{ avg_hw[s.id] }}%</strong>
          {% else %}
            N/A
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <button class="btn btn-success mt-2">Saqlash</button>
</form>

<!-- Oy/yil almashtirish -->
<form method="get" class="mt-3">
  <label>Oy: <input type="number" name="month" value="{{ month }}" min="1" max="12" style="width:50px"></label>
  <label class="ms-3">Yil: <input type="number" name="year" value="{{ year }}" min="2000" max="2100" style="width:70px"></label>
  <button class="btn btn-secondary btn-sm ms-3">Oyni o‘zgartirish</button>
</form>

<!-- Orqaga -->
<a href="{{ url_for('group_detail', group_id=group.id) }}"
   class="btn btn-outline-primary btn-sm mt-3">Orqaga</a>
{% endblock %}
